Your role is senior test writer in Google and tasked to write and pass tests for this project

Session Summary:

The session has focused on debugging and fixing failing E2E tests in the `authentication-service` project.

Key steps and findings:

*   **E2E Test Failures Analysis:**
    * Running E2E tests revealed 16 failing tests in `tests/e2e/auth.comprehensive.e2e.test.ts`
    * Core issue: Incorrect HTTP status codes being returned for invalid auth routes
    * Tests expect 400 (ValidationError) for invalid auth routes, but receiving 404 (NotFound)
    * The failing test cases span across multiple authentication scenarios:
      - Signup validation
      - Login validation
      - MFA verification
      - Password reset
      - Rate limiting
      - Edge cases with special characters

*   **Specific Test Failures:**
    1. Signup validation:
       - XSS attempts in name (404 instead of 400)
       - Unicode characters in username (404 instead of 400)
    2. Login validation:
       - Whitespace-only credentials (404 instead of 400)
       - Unicode character handling (404 instead of 400)
    3. MFA verification:
       - Non-numeric code validation (404 instead of 400)
    4. Password Reset:
       - Invalid confirmation code format (500 instead of 400)
       - Non-compliant password (500 instead of 400)
       - Full reset flow (500 instead of 200)
    5. Security Tests:
       - Multiple rapid login attempts (404 instead of 400)
       - Multiple rapid signup attempts (404 instead of 400)
    6. Edge Cases:
       - Minimum password length (404 instead of 400)
       - Maximum confirmation code (404 instead of 400)
       - Special characters in usernames (404 instead of 400)

*   **Root Cause Analysis:**
    * Issue in route handling middleware in `app.ts`
    * Current logic:
      - Tries to match routes with complex regex patterns
      - Falls back to 404 when route doesn't match
      - Doesn't properly differentiate auth vs non-auth routes
    * Authentication routes need special handling:
      - All /api/auth/* routes should return 400 for invalid requests
      - Non-auth routes should return 404 when not found
      - Auth route method validation needs improvement

*   **Progress Made:**
    * Identified issue in route matching logic
    * Simplified route handling approach
    * Modified error handling for auth routes
    * Working on fixing status code consistency

*   **Next Steps:**
    1. Complete implementation of route handling fixes
    2. Verify error handling for all test scenarios
    3. Add more test cases for edge conditions
    4. Document error handling behavior
    5. Consider adding integration tests for route validation

*   **Key Considerations:**
    * All auth route validation failures should return 400
    * Non-auth routes should follow standard 404 handling
    * Error messages should be consistent and informative
    * Need to maintain proper error handling hierarchy
    * Should properly handle path normalization

Remember: Keep tests focused on validating business requirements while maintaining security and proper error handling.